<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>GUN BATTLES — Ultimate</title>
<style>
body{margin:0;font-family:sans-serif;background:#071021;color:#fff;}
.app{max-width:1200px;margin:20px auto;padding:10px;}
header{display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;}
button{padding:12px 24px;margin:5px;border:none;border-radius:10px;cursor:pointer;font-weight:bold;font-size:16px;background:linear-gradient(45deg,#ffd700,#ffb700);color:#000;text-shadow:0 0 5px #fff,0 0 10px #fff;}
.case-card{background:#0b1220;padding:12px;margin:6px 0;border-radius:12px;display:flex;justify-content:space-between;align-items:center;font-size:18px;}
#wheel-container{position:relative;overflow:hidden;height:150px;margin:10px 0;border-radius:12px;background:#0d1b24;}
#wheel{display:flex;transition:transform 0s linear;}
.wheel-item{min-width:120px;height:120px;background:#122232;margin:0 4px;text-align:center;padding:10px;border-radius:8px;flex-shrink:0;display:flex;flex-direction:column;align-items:center;justify-content:center;}
.wheel-item img{width:80px;height:80px;object-fit:contain;margin-bottom:5px;}
#marker{position:absolute;top:0;bottom:0;width:6px;left:50%;transform:translateX(-50%);z-index:10;box-shadow:0 0 10px #ffd700,0 0 20px #ffd700,0 0 30px #ffd700;animation:glow 1s infinite alternate;}
@keyframes glow{from{box-shadow:0 0 5px #ffd700,0 0 10px #ffd700,0 0 15px #ffd700;}to{box-shadow:0 0 15px #ffd700,0 0 25px #ffd700,0 0 35px #ffd700;}}
.inventory, .tasks{display:none;background:#0b1220;padding:10px;margin-top:10px;border-radius:12px;}
.task-item{border:2px solid #0ff;margin:6px 0;padding:8px;border-radius:8px;color:#0ff;text-shadow:0 0 5px #0ff;}
.modal{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.6);justify-content:center;align-items:center;}
.modal-content{background:#07131a;padding:20px;border-radius:12px;}
input.promo-input{width:70%;padding:6px;border-radius:6px;border:1px solid rgba(255,255,255,0.2);background:#07121a;color:#fff;margin-right:8px;}
</style>
</head>
<body>
<div class="app">
<header>
<div>GUN BATTLES - ⭐<span id="balance">200</span></div>
<div>
<button id="topup">Пополнить</button>
<button id="inventoryBtn">Инвентарь</button>
<button id="tasksBtn">Задания</button>
<button id="promoBtn">Промокод</button>
</div>
</header>

<h3>Кейсы</h3>
<div id="casesList"></div>

<div id="wheel-container">
<div id="marker"></div>
<div id="wheel"></div>
</div>
<div><button id="openBtn" disabled>Открыть кейс</button></div>
<div id="result"></div>

<div class="inventory" id="inventoryDiv">
<h4>Инвентарь</h4>
<div id="invItems"></div>
</div>

<div class="tasks" id="tasksDiv">
<h4>Задания</h4>
<div class="task-item" id="task1">Подписаться на канал - +50⭐ <button onclick="completeTask(1)">Выполнить</button></div>
<div class="task-item" id="task2">Реферальная ссылка - +30⭐ за реферала <span id="refCount">(0)</span> <button onclick="completeTask(2)">Проверить</button></div>
</div>

<div class="modal" id="modalPromo">
<div class="modal-content">
<h4>Промокод</h4>
<input type="text" id="promoInput" class="promo-input" placeholder="Введите код">
<button id="applyPromo">Активировать</button>
<div id="promoMsg"></div>
<button onclick="closePromo()">Закрыть</button>
</div>
</div>

<script>
// --- DATA ---
let balance = parseInt(localStorage.getItem('balance'))||200;
document.getElementById('balance').innerText = balance;
let refCount = parseInt(localStorage.getItem('refCount'))||0;
document.getElementById('refCount').innerText = `(${refCount})`;

const ITEMS = {
  'awp_dragon':{name:'AWP Dragon Lore',value:300000,chance:1,img:'https://i.imgur.com/ybI8p5y.png'},
  'awp_medusa':{name:'AWP Medusa',value:90000,chance:4,img:'https://i.imgur.com/V5cxw2Y.png'},
  'deagle_gold':{name:'Deagle Gold',value:30000,chance:2,img:'https://i.imgur.com/LbKZK7V.png'},
  'deagle_blaze':{name:'Deagle Blaze',value:9000,chance:10,img:'https://i.imgur.com/nzZ1V0R.png'},
  'knife_secret':{name:'Secret Knife',value:120000,chance:0.1,img:'https://i.imgur.com/g2kZ63Y.png'}
};

const CASES = [
{id:'awp',title:'AWP CASE',price:400,items:['awp_dragon','awp_medusa','awp_medusa','awp_dragon']},
{id:'deagle',title:'Deagle CASE',price:200,items:['deagle_gold','deagle_blaze','deagle_gold','deagle_blaze']},
{id:'free',title:'FREE CASE',price:0,items:['awp_medusa','knife_secret','deagle_gold','awp_medusa','knife_secret']}
];

let inventory = JSON.parse(localStorage.getItem('inventory'))||[];
let selectedCase = null;

// --- Render cases ---
const casesList = document.getElementById('casesList');
CASES.forEach(c=>{
  let div = document.createElement('div');
  div.className='case-card';
  div.innerHTML=`<span>${c.title} — ${c.price}⭐</span><button onclick="selectCase('${c.id}')">Выбрать</button>`;
  casesList.appendChild(div);
});

// --- Select case ---
function selectCase(id){
  selectedCase = CASES.find(c=>c.id===id);
  const wheel = document.getElementById('wheel');
  wheel.innerHTML='';
  for(let i=0;i<200;i++){ // ~1000 предметов
    selectedCase.items.forEach(it=>{
      let div=document.createElement('div');div.className='wheel-item';
      div.innerHTML=`<img src="${ITEMS[it].img}" alt="${ITEMS[it].name}"><span>${ITEMS[it].name}</span>`;
      wheel.appendChild(div);
    });
  }
  document.getElementById('openBtn').disabled=false;
  document.getElementById('result').innerText='';
}

// --- Open case ---
document.getElementById('openBtn').onclick = ()=>{
  if(!selectedCase) return;
  if(balance<selectedCase.price){alert('Недостаточно звезд'); return;}
  balance -= selectedCase.price;
  localStorage.setItem('balance',balance);
  document.getElementById('balance').innerText=balance;

  const total = selectedCase.items.reduce((a,it)=>a+ITEMS[it].chance,0);
  let rnd = Math.random()*total;
  let sum=0,result=null;
  for(let it of selectedCase.items){
    sum+=ITEMS[it].chance;
    if(rnd<=sum){result=it;break;}
  }

  const wheel = document.getElementById('wheel');
  const itemWidth = wheel.querySelector('.wheel-item').offsetWidth + 8;
  const itemsArray = Array.from(wheel.children);
  let targetIndex = itemsArray.findIndex(div=>div.querySelector('span').innerText===ITEMS[result].name);
  let spins = Math.floor(Math.random()*itemsArray.length*2) + itemsArray.length;
  let finalTranslate = -(targetIndex + spins)*itemWidth + wheel.offsetWidth/2 - itemWidth/2;

  let duration = 5000;
  wheel.style.transition=`transform ${duration/1000}s cubic-bezier(.25,.1,.25,1)`;
  wheel.style.transform=`translateX(${finalTranslate}px)`;

  setTimeout(()=>{
    inventory.push(result);
    localStorage.setItem('inventory',JSON.stringify(inventory));
    document.getElementById('result').innerText=`Вы получили: ${ITEMS[result].name}`;
  },duration);
}

// --- Inventory ---
document.getElementById('inventoryBtn').onclick = ()=>{
  const div = document.getElementById('inventoryDiv');
  div.style.display = div.style.display==='none'?'block':'none';
  renderInventory();
}
function renderInventory(){
  const inv = document.getElementById('invItems');
  inv.innerHTML='';
  inventory.forEach((it,i)=>{
    let d=document.createElement('div');
    d.innerHTML=`${ITEMS[it].name} - ${ITEMS[it].value}⭐ <button onclick="sellItem(${i})">Продать</button>`;
    inv.appendChild(d);
  });
}
function sellItem(i){
  balance+=ITEMS[inventory[i]].value;
  inventory.splice(i,1);
  localStorage.setItem('inventory',JSON.stringify(inventory));
  localStorage.setItem('balance',balance);
  document.getElementById('balance').innerText=balance;
  renderInventory();
}

// --- Tasks ---
document.getElementById('tasksBtn').onclick=()=>{
  const div = document.getElementById('tasksDiv');
  div.style.display = div.style.display==='none'?'block':'none';
}
function completeTask(taskId){
  if(taskId===1){ // Подписка
    balance+=50;
    localStorage.setItem('balance',balance);
    document.getElementById('balance').innerText=balance;
    alert('Задание выполнено! +50⭐');
  } else if(taskId===2){ // Реферал
    refCount++;
    balance+=30;
    localStorage.setItem('balance',balance);
    localStorage.setItem('refCount',refCount);
    document.getElementById('balance').innerText=balance;
    document.getElementById('refCount').innerText = `(${refCount})`;
    alert('Реферал зачислен! +30⭐');
  }
}

// --- Promo ---
const PROMOS={'FREE50STAR':50,'DRAGONLORETOP':450};
let usedPromo = JSON.parse(localStorage.getItem('usedPromo'))||[];
document.getElementById('promoBtn').onclick=()=>{document.getElementById('modalPromo').style.display='flex';}
document.getElementById('applyPromo').onclick=()=>{
  let code = document.getElementById('promoInput').value.trim().toUpperCase();
  if(PROMOS[code] && !usedPromo.includes(code)){
    balance+=PROMOS[code];
    localStorage.setItem('balance',balance);
    document.getElementById('balance').innerText=balance;
    usedPromo.push(code);
    localStorage.setItem('usedPromo',JSON.stringify(usedPromo));
    document.getElementById('promoMsg').innerText=`Промокод активирован: +${PROMOS[code]}⭐`;
  } else document.getElementById('promoMsg').innerText='Неверный код или уже использован';
}
function closePromo(){document.getElementById('modalPromo').style.display='none';}

// --- Topup ---
document.getElementById('topup').onclick = ()=>{alert('Пополнение через Telegram: @Dadilk');}
</script>
</body>
</html>